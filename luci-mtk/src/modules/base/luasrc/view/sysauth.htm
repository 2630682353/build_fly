<%#
LuCI - Lua Configuration Interface
Copyright 2008 Steven Barth <steven@midlink.org>
Copyright 2008-2012 Jo-Philipp Wich <xm@subsignal.org>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

	http://www.apache.org/licenses/LICENSE-2.0

-%>
<html>
<body>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
		<link rel="stylesheet" href="<%=resource%>/css/bootstrap.css">
       <link rel="stylesheet" href="<%=resource%>/css/base.css">
        <link rel="stylesheet" href="<%=resource%>/css/router.css">
         <link rel="stylesheet" href="<%=resource%>/css/jfwx.css">
<% if node and node.css then %><link rel="stylesheet" type="text/css" media="screen" href="<%=resource%>/<%=node.css%>" />
<% end -%>
<!--[if IE 6]><link rel="stylesheet" type="text/css" media="screen" href="<%=media%>/ie6.css" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" type="text/css" media="screen" href="<%=media%>/ie7.css" /><![endif]-->
<!--[if IE 8]><link rel="stylesheet" type="text/css" media="screen" href="<%=media%>/ie8.css" /><![endif]-->
<script type="text/javascript" src="<%=resource%>/xhr.js"></script>
<script type="text/javascript">
if (top.location != self.location){
alert("登陆已超时，请重新登陆")
top.location=top.location;
}


</script>
<div class="top">
            <div class="wrap">
                <a href="http://www.aviup.com/" target="_blank"><div class="logo"></div></a>
            </div>	
        </div>
<form method="post" action="<%=pcdata(luci.http.getenv("REQUEST_URI"))%>">
		<input type="hidden" name="username" value="<%=duser%>"/>
		<div class="cbi-map-descr">
			<%- if fuser then %>
			<div class="error" style="color:#000;"><%:Invalid password! Please try again.%></div>
			<br />
			<% end -%>
		</div>

		 <!-- 设置过密码的主页面 -->        
        <div class="wrap">
            <div class="content">
                <div class="img-box"><a href="http://www.aviup.com/" target="_blank"><div class="index_logo"></div></a></div>
                <p class="index_text">欢迎使用建飞无线企业网关</p>
                <div class="con">
                    <ul class="list">
                        <li>
                            <span class="sp-l">管理密码</span>
                            <span class="sp-r">
                                
                                <input type="password" name="password" class="inpt" style="height:34px" id="focus_password" placeholder="在此输入用户密码">
                            </span>
                        </li>
                    </ul>
                    <div class="sb" style="margin-top:10px;">
                       <input type="submit" style="border:none" value="<%:Login%>"/>
                    </div>
                </div>   
            </div>
        </div>
        <!-- 设置过密码的主页面 end--> 

    

<!--		<fieldset class="cbi-section2">	
				<div style="margin:auto;">
					<input id="focus_password" class="cbi-input-password" type="password" style="width:130px; height: 26px;" name="password" />
			</div>

			<div>
			<input type="submit" value="<%:Login%>" class="cbi-button cbi-button-apply1" />
			</div>

	   </fieldset>
-->

</form>
<script type="text/javascript">//<![CDATA[
	var input = document.getElementById('focus_password');
	if (input)self.location
		input.focus();
//]]></script>

<%
local uci  = require "luci.model.uci".cursor()
local fs  = require "nixio.fs"
local https_key = uci:get("uhttpd", "main", "key")
local https_port = uci:get("uhttpd", "main", "listen_https")
if type(https_port) == "table" then
	https_port = https_port[1]
end

if https_port and fs.access(https_key) then
	https_port = https_port:match("(%d+)$")
%>

<script type="text/javascript">//<![CDATA[
	if (document.location.protocol != 'https:') {
		var url = 'https://' + window.location.hostname + ':' + '<%=https_port%>' + window.location.pathname;
		var img=new Image;
		img.onload=function(){window.location = url};
		img.src='https://' + window.location.hostname + ':' + '<%=https_port%>' + '<%=resource%>/cbi/up.gif?' + Math.random();;
		setTimeout(function(){
			img.src=''
		}, 5000);
	}
//]]></script>

<% end %>
</body>
</html>