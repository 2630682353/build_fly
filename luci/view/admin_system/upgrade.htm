<%#
LuCI - Lua Configuration Interface
Copyright 2008 Steven Barth <steven@midlink.org>
Copyright 2008-2009 Jo-Philipp Wich <xm@subsignal.org>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

	http://www.apache.org/licenses/LICENSE-2.0

$Id$

-%>

<%+header%>
<div class="main-content"><div class="info-box">
<div style="margin-left:50px">
<h2><a id="content" name="content" style="font-size:18px;font-weight:bold"><%:Flash Firmware%> - <%:Verify%></a></h2>
<p>
	<%_ The flash image was uploaded.
		Below is the checksum and file size listed,
		compare them with the original file to ensure data integrity.<br />
		Click "Proceed" below to start the flash procedure. %>
<br/><br/>
	<% if storage > 0 and size > storage then %>
		<br /><br />
		<div class="error"><%:It appears that you are trying to
			flash an image that does not fit into the flash memory, please verify
			the image file! %></div>
	<% end %>

</p>

<fieldset class="cbi-section">
	<ul>
		<li><%:Checksum%>: <code><%=checksum%></code></li>
		<li><%:Size%>: <%
			local w = require "luci.tools.webadmin"
			write(w.byte_format(size))

			if storage > 0 then
				write(luci.i18n.translatef(
					" (%s available)",
					w.byte_format(storage)
				))
			end
		%></li>
		<li><% if keep then %>
			<%:Configuration files will be kept.%>
		<% else %>
			<%:Note: Configuration files will be erased.%>
		<% end %></li>
	<div id="apply" style="display:none">
		<img src="<%=resource%>/icons/loading.gif" alt="<%:Loading%>" style="vertical-align:middle" />
		<%:Waiting for changes to be applied...%>
	</div>
	</ul>
</fieldset>

<div class="cbi-page-actions right">
	<form style="display:inline" action="<%=REQUEST_URI%>" method="post">
		<button id="btn1" class="cbi-button cbi-button-reset" type="submit"><%:Cancel%></button>
	</form>
	<button id="btn2" class="cbi-button cbi-button-reset"><%:Proceed%></button>

</div>

<script type="text/javascript" src="<%=media%>/jquery-1.3.2.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $("#btn2").click(function(){
	var formdata = new FormData();
	formdata.append("step","2");
	formdata.append("keep","<%=keep and "1" or ""%>");
	var oReq = new XMLHttpRequest();
	oReq.open("POST","<%=REQUEST_URI%>");
	oReq.send(formdata);
	document.getElementById("btn1").style.display = "none";
	document.getElementById("btn2").style.display = "none";
	document.getElementById("apply").style.display = "block";
	setTimeout("document.getElementById('apply').style.display = 'none'",120000);
	setTimeout("alert('Successful upgrade, please reconnect wifi and refresh!')",120000);

});
});
</script>
</div>
<%+footer%>
